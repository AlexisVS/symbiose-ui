<div>
    <planning-calendar-navbar [consumption]="hovered_consumption" [rental_unit]="hovered_rental_unit" [holidays]="hovered_holidays"></planning-calendar-navbar>
</div>

<div class="container">
    <mat-progress-bar [class.hidden]="!loading" mode="indeterminate"></mat-progress-bar>
    <table #calTable class="cal-table">
        <!-- header -->
        <thead>
            <tr class="head" >
                <td #calTableRefColumn class="ref-column cell-room" rowspan="2">ref.</td>
                <td class="stat-column cell-room" rowspan="2">stat.</td>
                <th class="head-months" *ngFor="let month of headers.months" [attr.colspan]="month.days.length" >
                    {{ month.date | date : 'MMMM y' }}
                </th>
            </tr>
            <tr class="head">
                <ng-container *ngFor="let day of headers.days" >
                    <th #calTableHeadCells
                        (mouseenter)="onhoverDate(day)" 
                        (mouseleave)="onhoverDate(null)" 
                        class="head-days" 
                        [class.small]="cells_width <= 26" 
                        [class.hidden]="cells_width < 10" 
                        [ngClass]="getHolidayClasses(day)">
                            <div *ngIf="cells_width > 26" class="week-day">{{ day | date: 'EEE'}}</div>
                            <div *ngIf="cells_width <= 26" class="week-day">{{ day | date: 'EEEEE'}}</div>
                            <div class="month-day">{{ day | date: 'd'}}</div>
                    </th>
                </ng-container>
            </tr>
        </thead>
        <tbody>
            <!-- body -->
            <tr class="rows" *ngFor="let rental_unit of rental_units; let index = index;">
                <td class="cell-room rental-unit" (mouseenter)="onhoverRentalUnit(rental_unit)"  (mouseleave)="onhoverRentalUnit(null)" (click)="onSelectedRentalUnit(rental_unit)">{{ rental_unit.code }}<span class="cell-hint">{{ rental_unit.name }}</span></td>
                <td class="cell-room status">
                    <i *ngIf="rental_unit.status == 'ready'" class="material-icons" style="color: green;">check</i>
                    <i *ngIf="rental_unit.status == 'busy_part'" class="material-icons">add_home</i>
                    <i *ngIf="rental_unit.status == 'busy_full'" class="material-icons">home_filled</i>
                    <i *ngIf="rental_unit.status == 'ooo'" class="material-icons">block</i>
                </td>

                <td *ngFor="let day of headers.days" class="cell-days" [class.is-weekend]="isWeekEnd(day)" (mouseenter)="onhoverDay(rental_unit, day)"  (mouseleave)="onhoverDay(null, null)">

                    <!-- <div class="cell-overlay" (mouseenter)="onhoverDay(rental_unit, day)"  (mouseleave)="onhoverDay(null, null)"></div> -->

                    <div *ngIf="isToday(day)" class="is-today"></div>

                    <planning-calendar-booking
                        *ngIf="hasConsumption(rental_unit, day)"
                        [width]="cells_width"
                        [day]="day"
                        [consumption]="getConsumption(rental_unit, day)"
                        (hover)="onhoverBooking($event)"
                        (selected)="onSelectedBooking($event)">
                    </planning-calendar-booking>
                </td>
            </tr>
        </tbody>
    </table>
</div>