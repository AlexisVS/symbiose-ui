<div class="overlay-container" *ngIf="!ready">
    <mat-spinner></mat-spinner>
</div>

<div class="container" *ngIf="ready">
    <div class="header-wrap">
        <div class="header">Session › {{session.name}} <small>{{session.id}}</small> › <a [attr.href]="'#/session/'+session.id+'/orders'">Commandes en cours</a></div>
        <div style="display: flex; align-items: center;">
            <app-close></app-close>
        </div>
    </div>
    <div class="pos-body" #fullScreen>
        <div style="display: flex;">
            <div class="body">
                <div class="view">
                    <div class="order">
                        <h2>Commande</h2>
                        <div class="total">
                            <span class="total"> Total : {{ instance.price | number : '1.2-2' }}€ </span>
                            <span class="taxes"> Taxes : {{ taxes | number : '1.2-2'}}€ </span>
                        </div>
                    </div>
                    <div *ngIf="session.status != 'pending'">Cette session n'est plus active.</div>
                    <ng-container *ngIf="session.status == 'pending'">
                        <div class="products">
                            <div [class.hidden]="current_pane !='discount'">
                                <session-order-lines-discount-pane 
                                    [model]="selectedLine" 
                                    (selectField)="onSelectField($event)"
                                    (closePane)="switchPane('main')">
                                </session-order-lines-discount-pane>
                            </div>
                            <div [class.hidden]="current_pane !='main'">
                                <session-order-lines-orderline *ngFor="let line of instance.order_lines_ids; index as i"
                                    [model]="line" 
                                    [selected]="line.id == selectedLine?.id"                                
                                    (updated)="onupdateLine()" 
                                    (deleted)="ondeleteLine()"
                                    (click)="onSelectLine(line)">
                                </session-order-lines-orderline>
                            </div>
                        </div>
                    </ng-container>
                </div>
                <div class="pad">
                    <order-keypad-lines 
                        [customer_name]="customer_name" 
                        [back_button]="'payment'"
                        (onDisplayDetails)="onDisplayDetails($event)" 
                        (onKeyPressed)="onPadPressed($event)"
                        (onInvoice)="onGetInvoice($event)" 
                        (onTypeMode)="onSelectField($event)"                        
                        (customer_change)="customer_change($event)">
                    </order-keypad-lines>
                </div>
            </div>
            <div style="width: 100%; height: 100vh;">
                <session-order-lines-orderitems
                    [error_message]="error_message" 
                    (addedBookingOrderLine)="onAddBookingOrderLine($event)"
                    (addedProduct)="onAddProduct($event)"></session-order-lines-orderitems>
            </div>
        </div>
    </div>

</div>