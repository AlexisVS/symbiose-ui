<div class="overlay-container" *ngIf="!ready">
    <mat-spinner></mat-spinner>
</div>
<div class="header-wrap">
    <div class="header">Session › {{session.name}} <small>{{session.id}}</small> › Commandes en cours </div>
    <app-close></app-close>
    <!-- <a (click)="openFullscreen()" title="Full Screen"> Toggle fullscreen </a> -->
</div>
<div style="display: flex;" #fullScreen>
    <div>
        <div class="container" *ngIf="ready">
            <div class="body">
                <div class="view">
                    <div class="order">
                        <div style="display: flex; justify-content: center; align-items: center;">
                            <h2>Commande</h2> <button mat-mini-fab color="accent"
                                (click)="onclickCreateNewPayment()">
                                <mat-icon>add</mat-icon>
                            </button>
                        </div>
                        <p><b> TOTAL: {{instance.total}}</b></p>
                    </div>
                    <div *ngIf="session.status != 'pending'">Cette session n'est plus active.</div>
                    <div *ngIf="session.status == 'pending'">
                        <div style="min-height: 35vh; overflow: auto; max-height: 42vh; overflow: auto;">
                            <ng-container *ngFor="let payment of instance.order_payments_ids; index as i">
                                <session-order-payments-order-payment (click)="onClickLine(i)" [model]="payment"
                                    (updated)="onupdatePayment(payment.id)" (updatedQty)="onupdateQty()" (deleted)="ondeletePayment(payment.id)"
                                    (validated)="makePayment($event)" (selectedPaymentPart)="selectedPaymentPart = $event"
                                    (selectedOrderLine)="selectedOrderLine = $event" [customer]="customer">
                                </session-order-payments-order-payment>
                            </ng-container>
                        </div>
                    </div>
                </div>
                <div class="pad">
                    <app-pos-arbitrary-numbers (onGetInvoice)="onGetInvoice($event)" [disabled_key]="disabled_key" [back_button]="back_button" (onDisplayDetails)="onDisplayDetails($event)"
                        (onDigitTyped)="onDigitTyped($event)" (onTypeMode)="typeMode = $event"
                        [customer_name]="customer_name" (customer_change)="customer_change($event)">
                    </app-pos-arbitrary-numbers>
                </div>
            </div>
        </div>
        <div style="width: 100%;">
            <mat-tab-group animationDuration="0ms" mat-align-tabs="end" [backgroundColor]="'primary'">
                <mat-tab label="OrderLines" style="width: 100%;"> 
                    <table mat-table [dataSource]="dataSource" class="mat-elevation-z8" style="width: 100%;">
                        <!-- Checkbox Column -->
                        <ng-container matColumnDef="select">
                        <th mat-header-cell *matHeaderCellDef>
                            <mat-checkbox (change)="$event ? toggleAllRows() : null"
                                        [checked]="selection?.hasValue() && isAllSelected()"
                                        [indeterminate]="selection?.hasValue() && !isAllSelected()"
                                        [aria-label]="checkboxLabel()">
                            </mat-checkbox>
                        </th>
                        <td mat-cell *matCellDef="let row">
                            <mat-checkbox (click)="$event?.stopPropagation();"
                                        (change)="$event ? selection.toggle(row) : null"
                                        [checked]="selection?.isSelected(row)"
                                        [aria-label]="checkboxLabel(row)">
                            </mat-checkbox>
                        </td>
                        </ng-container>

                        <ng-container matColumnDef="name">
                            <th mat-header-cell *matHeaderCellDef> Nom </th>
                            <td mat-cell *matCellDef="let element"> {{element.name}} </td>
                        </ng-container>
                    
                        <!-- Position Column -->
                        <ng-container matColumnDef="price">
                        <th mat-header-cell *matHeaderCellDef> Prix </th>
                        <td mat-cell *matCellDef="let element"> {{element.total}} </td>
                        </ng-container>
                    
                        <!-- Name Column -->
                        <ng-container matColumnDef="qty">
                        <th mat-header-cell *matHeaderCellDef> Quantité </th>
                        <td mat-cell *matCellDef="let element"> {{element.qty}} </td>
                        </ng-container>
                    
                        
                        <tr mat-header-row *matHeaderRowDef="['select', 'name', 'price', 'qty']"></tr>
                        <tr mat-row *matRowDef="let row; columns: ['select', 'name', 'price', 'qty'];"
                            (click)="selection.toggle(row)">
                        </tr>
                    </table>
                
                </mat-tab>
                <mat-tab label="Ticket" class="ticket" style="height:  100vh !important;">  
                    <div class="ticket">
                        <button (click)="onPrint()" mat-raised-button [color]="'primary'"
                        style="padding: 0.25rem; display: flex; align-items: center; justify-content: center; margin-top: 12px; margin-bottom: 12px; font-size: 1.2rem;">
                        <mat-icon>print</mat-icon> <span>Imprimer le reçu</span>
                        </button>
                        <!-- <button (click)="makePayment()" mat-raised-button [color]="'primary'" style="width: 100%;"> Payer </button> -->
                        <app-ticket [invoice]="invoice"></app-ticket>
                    </div> 
                </mat-tab>
                
            </mat-tab-group>
        </div>
    </div>
</div>